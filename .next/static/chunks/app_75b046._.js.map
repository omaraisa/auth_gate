{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file://E%3A/Dev/Applications/auth_gate/app/lib/authenticateArcGIS.ts"],"sourcesContent":["'use client';\r\n\r\nimport esriConfig from '@arcgis/core/config';\r\nimport ServerInfo from '@arcgis/core/identity/ServerInfo';\r\nimport IdentityManager from '@arcgis/core/identity/IdentityManager';\r\n\r\nconst config = {\r\n  apiKey: process.env.NEXT_PUBLIC_ArcGISAPIKey ?? 'API_KEY_NOT_SET',\r\n  portalUrl: process.env.NEXT_PUBLIC_PORTAL_URL ?? 'PORTAL_URL_NOT_SET',\r\n  tokenServiceUrl: process.env.NEXT_PUBLIC_PORTAL_TOKEN_SERVICE_URL ?? 'PORTAL_TOKEN_NOT_SET',\r\n};\r\n\r\nesriConfig.apiKey = config.apiKey;\r\n\r\nconst serverInfo = new ServerInfo({\r\n  server: config.portalUrl,\r\n  tokenServiceUrl: config.tokenServiceUrl,\r\n});\r\n\r\nIdentityManager.registerServers([serverInfo]);\r\n\r\ninterface TokenResponse {\r\n  token: string;\r\n  expires: number;\r\n}\r\n\r\n// lib/authenticateArcGIS.ts\r\nexport const authenticateArcGIS = async (\r\n    username: string,\r\n    password: string\r\n  ): Promise<{ token: string; expires: number } | null> => {\r\n    try {\r\n      const response: TokenResponse = await IdentityManager.generateToken(serverInfo, {\r\n        username,\r\n        password,\r\n        client: 'referer',\r\n        referer: window.location.origin,\r\n      });\r\n  \r\n      IdentityManager.registerToken({\r\n        server: serverInfo.server ?? 'SERVER_URL_NOT_SET',\r\n        token: response.token,\r\n        expires: response.expires,\r\n      });\r\n  \r\n      return {\r\n        token: response.token,\r\n        expires: response.expires,\r\n      };\r\n    } catch (error) {\r\n      return null;\r\n    }\r\n  };\r\n  \r\n\r\nexport const checkArcGISSession = async (): Promise<{ loggedIn: boolean; userId?: string }> => {\r\n  try {\r\n    const credential = await IdentityManager.checkSignInStatus(config.portalUrl);\r\n    alert(`You are already logged in as ${credential}`);\r\n\r\n    return { loggedIn: true, userId: credential.userId };\r\n  } catch {\r\n    return { loggedIn: false };\r\n  }\r\n};"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AAGU;AAPV;;;;AAMA,MAAM,SAAS;IACb,QAAQ,4IAAwC;IAChD,WAAW,qEAAsC;IACjD,iBAAiB,gGAAoD;AACvE;AAEA,6IAAA,CAAA,UAAU,CAAC,MAAM,GAAG,OAAO,MAAM;AAEjC,MAAM,aAAa,IAAI,6JAAA,CAAA,UAAU,CAAC;IAChC,QAAQ,OAAO,SAAS;IACxB,iBAAiB,OAAO,eAAe;AACzC;AAEA,kKAAA,CAAA,UAAe,CAAC,eAAe,CAAC;IAAC;CAAW;AAQrC,MAAM,qBAAqB,OAC9B,UACA;IAEA,IAAI;QACF,MAAM,WAA0B,MAAM,kKAAA,CAAA,UAAe,CAAC,aAAa,CAAC,YAAY;YAC9E;YACA;YACA,QAAQ;YACR,SAAS,OAAO,QAAQ,CAAC,MAAM;QACjC;QAEA,kKAAA,CAAA,UAAe,CAAC,aAAa,CAAC;YAC5B,QAAQ,WAAW,MAAM,IAAI;YAC7B,OAAO,SAAS,KAAK;YACrB,SAAS,SAAS,OAAO;QAC3B;QAEA,OAAO;YACL,OAAO,SAAS,KAAK;YACrB,SAAS,SAAS,OAAO;QAC3B;IACF,EAAE,OAAO,OAAO;QACd,OAAO;IACT;AACF;AAGK,MAAM,qBAAqB;IAChC,IAAI;QACF,MAAM,aAAa,MAAM,kKAAA,CAAA,UAAe,CAAC,iBAAiB,CAAC,OAAO,SAAS;QAC3E,MAAM,CAAC,6BAA6B,EAAE,YAAY;QAElD,OAAO;YAAE,UAAU;YAAM,QAAQ,WAAW,MAAM;QAAC;IACrD,EAAE,OAAM;QACN,OAAO;YAAE,UAAU;QAAM;IAC3B;AACF"}},
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file://E%3A/Dev/Applications/auth_gate/app/hooks/actions.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { z } from 'zod';\r\nimport { redirect } from 'next/navigation';\r\nimport { authenticateArcGIS } from '../lib/authenticateArcGIS';\r\n\r\nconst loginSchema = z.object({\r\n  username: z.string().min(3, { message: 'Invalid username' }).trim(),\r\n  password: z.string().min(4, { message: 'Password must be at least 4 characters' }).trim(),\r\n});\r\n\r\nexport async function login(prevState: any, formData: FormData) {\r\n  const result = loginSchema.safeParse(Object.fromEntries(formData));\r\n\r\n  if (!result.success) {\r\n    return {\r\n      errors: result.error.flatten().fieldErrors,\r\n    };\r\n  }\r\n\r\n  const { username, password } = result.data;\r\n\r\n  const isAuthenticated = await authenticateArcGIS(username, password);\r\n\r\n  if (isAuthenticated) {\r\n    redirect(process.env.NEXT_PUBLIC_GEOPORTAL_URL || '/');\r\n  }\r\n\r\n  return {\r\n    errors: {\r\n      username: ['Invalid username or password'],\r\n    },\r\n  };\r\n}\r\n"],"names":[],"mappings":";;;AAGA;AACA;AAFA;AAuBa;AAzBb;;;;AAMA,MAAM,cAAc,uIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IAC3B,UAAU,uIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;QAAE,SAAS;IAAmB,GAAG,IAAI;IACjE,UAAU,uIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;QAAE,SAAS;IAAyC,GAAG,IAAI;AACzF;AAEO,eAAe,MAAM,SAAc,EAAE,QAAkB;IAC5D,MAAM,SAAS,YAAY,SAAS,CAAC,OAAO,WAAW,CAAC;IAExD,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,OAAO;YACL,QAAQ,OAAO,KAAK,CAAC,OAAO,GAAG,WAAW;QAC5C;IACF;IAEA,MAAM,EAAE,QAAQ,EAAE,QAAQ,EAAE,GAAG,OAAO,IAAI;IAE1C,MAAM,kBAAkB,MAAM,CAAA,GAAA,mIAAA,CAAA,qBAAkB,AAAD,EAAE,UAAU;IAE3D,IAAI,iBAAiB;QACnB,CAAA,GAAA,qIAAA,CAAA,WAAQ,AAAD,EAAE,6DAAyC;IACpD;IAEA,OAAO;QACL,QAAQ;YACN,UAAU;gBAAC;aAA+B;QAC5C;IACF;AACF"}},
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file://E%3A/Dev/Applications/auth_gate/app/components/login.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useActionState,useEffect } from \"react\";\r\nimport { login } from \"../hooks/actions\";\r\nimport { useState } from \"react\";\r\nimport { checkArcGISSession } from '../lib/authenticateArcGIS'\r\nimport { redirect } from 'next/navigation';\r\n\r\nexport function LoginForm() {\r\n  const [state, loginAction, pending] = useActionState(login, undefined);\r\n  const [showPopup, setShowPopup] = useState(false); \r\n\r\n  useEffect(() => {\r\n    const checkSession = async () => {\r\n      const session = await checkArcGISSession();\r\n\r\n      if (session.loggedIn) {\r\n            redirect(process.env.NEXT_PUBLIC_GEOPORTAL_URL || '/');\r\n      }\r\n    };\r\n\r\n    checkSession();\r\n  }, []);\r\n\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center  py-12 px-4 sm:px-6 lg:px-8\">\r\n      <div className=\"max-w-md w-full space-y-8 bg-white/50 rounded-xl shadow-lg overflow-hidden hover:shadow-2xl transition-shadow duration-300\">\r\n        <div className=\"px-8 py-6\">\r\n          <div className=\"text-center\">\r\n        <h2 className=\"mt-6 text-3xl font-extrabold text-gray-900\">\r\n          Welcome back!\r\n        </h2>\r\n          </div>\r\n          <form action={loginAction} className=\"mt-8 space-y-6\">\r\n        <div className=\"rounded-md shadow-sm -space-y-px\">\r\n          <div>\r\n            <label htmlFor=\"username\" className=\"sr-only\">\r\n          Username\r\n            </label>\r\n            <input\r\n          id=\"username\"\r\n          name=\"username\"\r\n          type=\"text\"\r\n          autoComplete=\"username\"\r\n          required\r\n          className=\"appearance-none rounded-t-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 text-sm hover:border-blue-500 transition-colors duration-200\"\r\n          placeholder=\"Username\"\r\n            />\r\n            {state?.errors?.username && (\r\n          <p className=\"mt-2 text-sm text-red-600\">{state.errors.username}</p>\r\n            )}\r\n          </div>\r\n          <div>\r\n            <label htmlFor=\"password\" className=\"sr-only\">\r\n          Password\r\n            </label>\r\n            <input\r\n          id=\"password\"\r\n          name=\"password\"\r\n          type=\"password\"\r\n          autoComplete=\"current-password\"\r\n          required\r\n          className=\"appearance-none rounded-b-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-blue-500 focus:border-blue-500 focus:z-10 text-sm hover:border-blue-500 transition-colors duration-200\"\r\n          placeholder=\"Password\"\r\n            />\r\n            {state?.errors?.password && (\r\n          <p className=\"mt-2 text-sm text-red-600\">{state.errors.password}</p>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        <SubmitButton pending={pending} />\r\n          </form>\r\n        </div>\r\n        <div className=\"bg-gray-50 px-8 py-4 hover:bg-gray-100 transition-colors duration-200\">\r\n          <div className=\"text-sm\">\r\n            <button onClick={() => setShowPopup(true)} className=\"font-medium text-blue-600 hover:text-blue-500\">\r\n              Don't have an account? Request access\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      {showPopup && (\r\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\r\n          <div className=\"bg-white p-6 rounded-lg shadow-lg max-w-sm w-full text-center\">\r\n            <h3 className=\"text-lg font-semibold mb-4\">Request Access</h3>\r\n            <p className=\"mb-4 text-sm text-gray-700\">\r\n              Please send an email to{\" \"}\r\n              <a href=\"mailto:fmelebary@jda.gov.sa\" className=\"text-blue-600 underline\">\r\n              fmelebary@jda.gov.sa\r\n              </a>{\" \"}\r\n              including your name, department, and reason for access request.\r\n            </p>\r\n            <button\r\n              onClick={() => setShowPopup(false)}\r\n              className=\"mt-2 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700\"\r\n            >\r\n              Close\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction SubmitButton({ pending }: { pending: boolean }) {\r\n  return (\r\n    <div>\r\n      <button\r\n        type=\"submit\"\r\n        disabled={pending}\r\n        className={`group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ${\r\n          pending ? \"opacity-50 cursor-not-allowed\" : \"\"\r\n        }`}\r\n      >\r\n        <span className=\"absolute left-0 inset-y-0 flex items-center pl-3\">\r\n          {pending ? (\r\n            <svg\r\n              className=\"animate-spin h-5 w-5 text-white\"\r\n              xmlns=\"http://www.w3.org/2000/svg\"\r\n              viewBox=\"0 0 24 24\"\r\n            >\r\n              <circle\r\n                className=\"opacity-25\"\r\n                cx=\"12\"\r\n                cy=\"12\"\r\n                r=\"10\"\r\n                stroke=\"currentColor\"\r\n                strokeWidth=\"4\"\r\n              ></circle>\r\n              <path\r\n                className=\"opacity-75\"\r\n                fill=\"currentColor\"\r\n                d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\r\n              ></path>\r\n            </svg>\r\n          ) : null}\r\n        </span>\r\n        {pending ? \"Logging in...\" : \"Log in\"}\r\n      </button>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 453, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}